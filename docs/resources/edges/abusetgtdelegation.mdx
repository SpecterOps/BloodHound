---
title: AbuseTGTDelegation
---

<img noZoom src="/assets/enterprise-AND-community-edition-pill-tag.svg"/> 

The trust from the target node domain to the source node domain has TGT delegation enabled.

When a resource in the source node domain is configured with unconstrained delegation, principals from the target node domain automatically forward their Ticket Granting Ticket (TGT) to that resource upon access.

## Abuse Info

An attacker with control over any domain within the forest can escalate their privileges to compromise other domains through multiple methods.

### Spoof SID history

An attacker can spoof the SID history of a principal in the target domain, tricking the target domain into treating the attacker as a privileged user.

See the SpoofSIDHistory edge for more information.

This attack fails if SID filtering (quarantine) is enabled on the trust relationship in the opposite direction of the attack. The SID filtering blocks SIDs belonging to any other domain than the attacker-controlled domain. However, enabling this setting is rare and generally not recommended.

### Coerce to TGT

An attacker can coerce a privileged computer (e.g., a DC) in the target domain to authenticate to an attacker-controlled computer configured with unconstrained delegation. This provides the attacker with a Kerberos TGT for the coerced computer.

See the [CoerceToTGT](/edges/coerce-to-tgt.mdx) edge for more information.

The attack fails if SID filtering (quarantine) is enabled, as this prevents TGTs from being sent across the trust boundary. Again, this setting is rarely configured.

### ADCS ESC5

The Configuration Naming Context (NC) is a forest-wide partition writable by any DC within the forest. Most Active Directory Certificate Services (ADCS) configurations are stored in the Configuration NC. An attacker can abuse a DC to modify ADCS configurations to enable an ADCS domain escalation opportunity that compromises the entire forest.

Attack Steps:

1. Obtain a SYSTEM session on a DC in the attacker-controlled domain.
2. Create a certificate template allowing ESC1 abuse.
3. Publish the certificate template to an enterprise CA.
4. Enroll the certificate as a privileged user in the target domain.
5. Authenticate as the privileged user in the target domain using the certificate.

See this blog post for further details: [From DA to EA with ESC5](https://posts.specterops.io/from-da-to-ea-with-esc5-f9f045aa105c).

If ADCS is not installed, an attacker can install ADCS and exploit it, as detailed in the blog post: [Escalating from child domain's admins to enterprise admins in 5 minutes by abusing AD CS, a follow up](https://www.pkisolutions.com/escalating-from-child-domains-admins-to-enterprise-admins-in-5-minutes-by-abusing-ad-cs-a-follow-up/).

### GPO linked on Site

AD sites are stored in the Configuration NC. An attacker with SYSTEM access to a DC can link a malicious GPO to the site of a any DC in the forest.

Attack steps:

1. Create a malicious GPO in the attacker-controlled domain.
2. Identify the site name for a target DC.
3. Obtain a SYSTEM session on a DC in the attacker-controlled domain.
4. Link the malicious GPO to the target site.
5. Wait for the GPO to apply on the target DC.

For further details, see this blog post: [SID filter as security boundary between domains? (Part 4) - Bypass SID filtering research](https://blog.improsec.com/tech-blog/sid-filter-as-security-boundary-between-domains-part-4-bypass-sid-filtering-research).

## Opsec Considerations

There is no OPSEC associated with this edge.

## References

This edge is related to the following MITRE ATT&CK tactic and techniques:

- [T1134.005: Access Token Manipulation: SID-History Injection](https://attack.mitre.org/techniques/T1134/005/)
- [T1187: Forced Authentication](https://attack.mitre.org/techniques/T1187/)
- [T1649: Steal or Forge Authentication Certificates](https://attack.mitre.org/techniques/T1649/)
- [T1558: Steal or Forge Kerberos Tickets](https://attack.mitre.org/techniques/T1558/)
- [T1550.003: Use Alternate Authentication Material: Pass the Ticket](https://attack.mitre.org/techniques/T1550/003/)
- [T1484.001: Domain or Tenant Policy Modification: Group Policy Modification](https://attack.mitre.org/techniques/T1484/001/)

### Abuse info references

- [Microsoft AD Trust Technical Documentation](https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2003/cc755321(v=ws.10))
- [From DA to EA with ESC5](https://posts.specterops.io/from-da-to-ea-with-esc5-f9f045aa105c)
- [Escalating from child domain's admins to enterprise admins in 5 minutes by abusing AD CS, a follow up](https://www.pkisolutions.com/escalating-from-child-domains-admins-to-enterprise-admins-in-5-minutes-by-abusing-ad-cs-a-follow-up/)
- [SID filter as security boundary between domains? (Part 4) - Bypass SID filtering research](https://blog.improsec.com/tech-blog/sid-filter-as-security-boundary-between-domains-part-4-bypass-sid-filtering-research)
